<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hexdle</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <!-- Bootstrap link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        :root{
        --green: rgb(159, 217, 130);
        --yellow: rgb(189, 186, 186);
        --gray: rgb(109, 108, 108);
        --border: #808080;
        --lg: rgb(223, 223, 223);
        }

        body{
            overflow-x: hidden;
            text-align: center;
        }

        .nozoom{
            touch-action:none;
        }

        h1{
            font-family: 'Fredoka One', sans-serif;
            font-size: 400%;
            -webkit-text-stroke-width: 2px;
            -webkit-text-stroke-color: black;
        }

        button{
            color:black;
        }

        #bg{
            margin: 0%;;
        }

        #color{
            display: flex;
            align-items: center;
            width: 100vw;
            color: white;
            min-height: 60px;
            height: 20vw;
            max-height: 80px;
        }

        .gbox{
            display: flex;
            align-items: center;
            border: 2px solid var(--lg);
            border-radius: 10px;

            /* min-height: 35px; */
            height: 12vw;

            /* min-width: 35px; */
            width: 12vw;
        }

        .exkey{
            display: flex;
            align-items: center;
            border: 2px solid var(--lg);
            border-radius: 10px;

            height: 8vw;
            min-height: 50px;

            width: 8vw;
            min-width: 50px;
        }


        .kbkey, .okey{
            background-color: var(--lg);
            border: 3px outset var(--lg);
            display: flex;
            border-radius: 10px;
            /* min-height: 25px; */
        }

        .kbkey{
            height: 10vw;
            /* min-width: 25px; */
            width: 10vw;
        }
        
        .okey{
            height: 10vw;
            max-height: 50px;
        }

        button:hover:not([disabled]){
            border: 3px outset var(--border);
        }

        .kbcontainer, .gboxcontainer{
            display: flex;
            align-items: center;
            max-width: 800px;
        }

        .popover {
            border: 2px solid var(--lg);
            border-radius: 10px;
        }

        .popover-body {
            height: 65vh;
            overflow-y: auto;
            overflow-x: hidden;
        }

        #qb{
            min-width: 25px;
            width: 12vw;
            max-width: 60px;
        }

        .venn {
            position: relative;
            height: 25vw;
            width: 25vw;
            max-height: 120px;
            max-width: 120px;
            margin: 0 auto;
            z-index:0;
        }

        [class^='circle-'] {
            position: absolute;
            width: 15vw;
            height: 15vw;
            max-height: 72px;
            max-width: 72px;
            border-radius: 50%;
            mix-blend-mode: screen;
            border: 2px solid var(--lg);
        }

        .circle-red {
            z-index: 1;
            top: 5%;
            left: 20%;
            background-color: rgb(255, 0, 0);
        }

        .circle-green {
            z-index: 3;
            right: 4%;
            bottom: 5%;
            background-color: rgb(0, 255, 0);
        }

        .circle-blue {
            z-index: 2;
            left: 4%;
            bottom: 5%;
            background-color: rgb(0, 0, 255);
        }

        .gray{
            background-color: var(--gray);
            color:white;
        }

        .yellow{
           background-color: var(--yellow);
           color:white;
        }

        .green{
            background-color: var(--green);
            color:white;
        }

        .tg-c{background-color:#00ffff;}
        .tg-bl{background-color:#333333;}
        .tg-b{background-color:#0000ff;}
        .tg-y{background-color:#ffff00;}
        .tg-q{background-color:#ffffff;}
        .tg-r{background-color:#ff0000;}
        .tg-l{background-color:#00ff00;}
        .tg-m{background-color:#ff00ff;}
        .tg-mr{background-color:#800000;}
        .tg-o{background-color:#808000;}
        .tg-g{background-color:#008000;}
        .tg-p{background-color:#800080;}
        .tg-t{background-color:#008080;}
        .tg-n{background-color:#000080;}

        .ctable{
            margin: auto;
            -webkit-transform: translateX(10px); 
            -moz-transform: translateX(10px);
            -ms-transform: translateX(10px);
            transform: translateX(10px);
            font-size: 80%;
        }

        .rounded{
            border: 2px solid var(--lg);
        }

        .shake{
            border-color: var(--border);
            animation: shake-animation 200ms ease;
            transform-origin: 50% 50%;
        }

        .flip {
        animation: flip 500ms ease forwards;
        }

        @media (prefers-reduced-motion: no-preference) {
            @keyframes shake-animation {
                0% { transform:translate(0,0) }
                1.78571% { transform:translate(5px,0) }
                3.57143% { transform:translate(0,5px) }
                5.35714% { transform:translate(0,0) }
                7.14286% { transform:translate(0,5px) }
                8.92857% { transform:translate(5px,0) }
                10.71429% { transform:translate(0,5px) }
                100% { transform:translate(0,0) }
            }

            @keyframes flip {
                0% {transform: scaleY(1);}
                50% {transform: scaleY(0);}
                100% {transform: scaleY(1);}
            }
        }

        @media (min-width: 992px), (max-height: 800px) {
            .exkey, .gbox{
                max-height: 70px;
                max-width: 70px;
            }

            .kbkey{
                max-height: 60px;
                max-width: 60px;
            }
        }
        @media (max-width: 450px){
            #kb{
                position:absolute;
                bottom:30px;
                left:0px;
                padding: 1rem;
            }

            .exkey{
                height: 15vw;
                width: 15vw;
            }
        }

        @media(max-height: 650px){
            #kb{
                position: inherit;
            }
        }

        @media (max-width: 350px){
            h1{
                font-size: 250%;
            }

            .exkey{
                min-width: fit-content;
            }
        }
    </style>
</head>
<body>
    <div id="bg" class="container-fluid p-0">
        <section id="color" class="mb-2">
                <h1 class="m-auto">H E X D L E</h1>
        </section>

        <section id="guesses" class="my-1">
        </section>

        <section id="kb" class="nozoom">
            <div class="mx-auto kbcontainer">
                <div class="mx-auto">
                    <div id="kb1" class="row m-auto my-1"></div>
                    <div id="kb2" class="row m-auto my-1"></div>
                    
                    <div class="row m-auto my-2">
                        <button type="button" id="qb" class="col-1 okey mx-2" data-toggle="popover" data-placement="top" data-popover-content="#p1"><h6 class="m-auto">?</h6></button>
                        <button type="button" id="del" disabled="true" class="col-2 p-0 okey"><h6 class="m-auto">âŒ«</h6></button>
                        <div class="col-4"></div>
                        <button type="button" id="enter" disabled="true" class="col-3 p-0 okey"><h6 class="m-auto">Enter</h6></button> 
                    </div>
                </div>     
            </div> 
        </section>
        <div class="row m-0 mt-2">
            <div class="col-12 text-center">
                <h6 id="alert"></h6>
            </div>
        </div> 
        <canvas id="myCanvas"></canvas>

        <div id="p1" style="display: none;">
            <div class="popover-body">
                <h6>How to Hexdle</h6>
            <p>Guess the hex code of the color of the title. The background will change to the value of your guess. </p>
            <div class="d-flex">
                <div class="d-flex align-items-center text-center mx-auto">
                    <div class="exkey green mx-1">
                        <p class="m-auto">right</p>
                    </div>
                    <div class="exkey yellow mx-1">
                        <p class="m-auto">wrong place</p>
                    </div>
                    <div class="exkey gray mx-1">
                        <p class="m-auto">wrong</p>
                    </div>
                </div>
            </div>
            <hr>
            <div>
                <h6>Unfamiliar with HEX Colors?</h6> 
                <p>HEX color is are used to represent an additive color model with hexadecimal values. Colors result from transmitted light. An absence of all light is black and the combination of all is white.</p>
                <!-- <img class="mw-100"src="light-diagram.png" alt="color-diagram"> -->
                <div class="venn">
                    <div class="circle-red"></div>
                    <div class="circle-green"></div>
                    <div class="circle-blue"></div>
                </div>
                <p class="mt-3">The first two letters/numbers refer to the percentage of red light, the next two refer to green light, and the last two refer to blue light.</p>
                <p>The color values are defined in values between 00 and FF, instead of from 0 to 255 in RGB. Numbers are used when the value is 1-9. Letters are used when the value is higher than 9 (eg: A=10, B=11, C=12...F=15)</p>
                <p>Use this chart to get started</p>
                
                <b>
                    <div class="row border-bottom">
                        <div class="col-3"> Color</div>
                        <div class="col-4">Hex</div>
                        <div class="col-5">RBG</div>
                     </div> 
                </b>
                <div class="ctable">              
                    <div class="row">Black</div>                 
                    <div class="row">
                        <div class="col rounded tg-bl"></div>
                        <div class="col-4">#000000</div>
                        <div class="col-6">(0, 0, 0)</div>
                    </div>
                    <div class="row">White</div> 
                    <div class="row">
                        <div class="col rounded tg-w"></div>
                        <div class="col-4">#FFFFFF</div>
                        <div class="col-6">(255, 255, 255)</div>
                    </div>
                    <div class="row">Red</div> 
                    <div class="row">
                        <div class="col rounded tg-r"></div>
                        <div class="col-4">#FF0000</div>
                        <div class="col-6">(255, 0, 0)</div>
                    </div>
                    <div class="row">Lime</div> 
                    <div class="row">
                        <div class="col rounded tg-l"></div>
                        <div class="col-4">#00FF00	</div>
                        <div class="col-6">(0, 255, 0)</div>
                    </div>
                    <div class="row">Blue</div> 
                    <div class="row">
                        <div class="col rounded tg-b"></div>
                        <div class="col-4">#0000FF	</div>
                        <div class="col-6">(0, 0, 255)</div>
                    </div>
                    <div class="row">Yellow</div> 
                    <div class="row">
                        <div class="col rounded tg-y"></div>
                        <div class="col-4">#FFFF00	</div>
                        <div class="col-6">(255, 255, 0)</div>
                    </div>
                    <div class="row">Cyan</div> 
                    <div class="row">
                        <div class="col rounded tg-c"></div>
                        <div class="col-4">#00FFFF</div>
                        <div class="col-6">(0, 255, 255)</div>
                    </div>
                    <div class="row">Magenta</div> 
                    <div class="row">
                        <div class="col rounded tg-m"></div>
                        <div class="col-4">#FF00FF</div>
                        <div class="col-6">(250, 0, 255)</div>
                    </div>
                    <div class="row">Maroon</div>
                    <div class="row">
                        <div class="col rounded tg-mr"></div>
                        <div class="col-4">#800000</div>
                        <div class="col-6">(128, 0, 0)</div>
                    </div>
                    <div class="row">Olive</div> 
                    <div class="row">
                        <div class="col rounded tg-o"></div>
                        <div class="col-4">#808000</div>
                        <div class="col-6">(128, 128, 0)</div>
                    </div>
                    <div class="row">Green</div> 
                    <div class="row">
                        <div class="col rounded tg-g"></div>
                        <div class="col-4">#008000</div>
                        <div class="col-6">(0, 128, 0)</div>
                    </div>
                    <div class="row">Purple</div> 
                    <div class="row">
                        <div class="col rounded tg-p"></div>
                        <div class="col-4">#800080</div>
                        <div class="col-6">(128, 0, 128)</div>
                    </div>
                    <div class="row">Teal</div> 
                    <div class="row">
                        <div class="col rounded tg-t"></div>
                        <div class="col-4">#008080</div>
                        <div class="col-6">(0, 128, 128)</div>
                    </div>
                    <div class="row">Navy</div> 
                    <div class="row">
                        <div class="col rounded tg-n"></div>
                        <div class="col-4">#000080</div>
                        <div class="col-6">(0, 0, 128)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    </div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    
    <!-- canvas confetti API -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <!-- jQuery link -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        'use strict';
        $(document).ready(function () {
            document.addEventListener("touchstart", function(){}, true);
            
            //enable bootstrap popover
            var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
            var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
                return new bootstrap.Popover(popoverTriggerEl)
            })


                $(function() {
                    $("[data-toggle=popover]").popover({
                        html: true,
                        trigger:'blur',
                        content: function() {
                        var content = $(this).attr("data-popover-content");
                        return $(content).children(".popover-body").html();
                        }
                    });
                });

            //initialize canvas conffetti 
            var myConfetti = confetti.create(myCanvas, { resize: true });

            //generate random color
            // https://stackoverflow.com/questions/47616381/how-to-exclude-all-shades-of-gray-while-generating-random-hex-color-code
            function randomColor() {
                // Threshold can be between 0 and 127: the higher it is, the more colors are considered to be too grey-like.
                const threshold = 50;

                // Generate three color parts randomly
                const parts = Array.from(Array(3), _ => 
                        Math.floor(Math.random()*256)
                    ).sort( (a, b) => a-b );
                
                // Check whether they are too close to the same value:
                if (parts[2] - parts[0] < threshold) { // color is too greyish

                    // Replace the middle one with a random value outside of the "too close" range
                    const exclude = Math.min(255, parts[0] + threshold) 
                                - Math.max(0, parts[2] - threshold);

                    parts[1] = Math.floor(Math.random()*(256-exclude));

                    if (parts[1] >= parts[2] - threshold) parts[1] += exclude;
                }

                // Shuffle and format the color parts and return the resulting string
                return parts
                    .sort( (a, b) => Math.random() < 0.5 )
                    .map( p => ('0' + p.toString(16)).substr(-2) )
                    .join('');
            }

            const targetcolor = randomColor().toLocaleUpperCase();

            $('#color').css('background-color', '#' + targetcolor);
            // $("head").append(`<meta name="theme-color" content="#${targetcolor}"/>`);

            $(':root').css('--lg', `#${targetcolor}40`);
            $(':root').css('--border', `#${targetcolor}ee`);
            $(':root').css('--green', `#${targetcolor}`);

            //if the title is clicked on 3 times show the answer
            let counter = 0;
            function cheat() {
                counter++;
                if(counter == 3){
                    $('#alert').append(`low key the answer is ${targetcolor}`);
                }
            }   
            $('#color').click(()=>{
                cheat();
            })

            const allowedtries = 6
            
            //generate grid
            for (let i=0; i < allowedtries; i++ ){//number of rows determined by number of tries allowed
                $('#guesses').append(`<div id="gcont${i}"class="mx-auto gboxcontainer"><div id="g${i}" class="row m-auto my-1">#</div></div>`);  
            }
            for (let r=0; r<6; r++){
                for (let c=0; c<6; c++){ 
                $('#g' + r).append(`<div id="gbox${r}${c}" class="col-2 mx-1 p-0 gbox"><h2 id="gtext${r}${c}" class="m-auto p-0"></h2></div>`);
                }
            }

            //generate keyboard
            const kb1 = ['0','1','2','3','4','5','6','7'];
            const kb2 = ['8','9','A','B','C','D','E','F'];
            for (const i in kb1){
                $('#kb1').append(`<button type="button" id="b${kb1[i]}" class="col mx-1 p-0 kbkey"><h6 class="m-auto">${kb1[i]}</h6></button>`)
                $('#kb2').append(`<button type="button" id="b${kb2[i]}" class="col mx-1 p-0 kbkey"><h6 class="m-auto">${kb2[i]}</h6></button>`)
            }

            //initialize game variables
            let game = true;
            let guess = [];
            let result = ['','','','','',''];

            let green = [];
            let yellow = [];
            let gray = [];

            let currow = 0; // attempt number
            let currcol = 0; // letter input

            $('.kbkey').click(function() {
                $('#del').prop('disabled', false);

                if (guess.length < 6){
                    const l = $(this).text().trim();
                    guess.push(l);
                    $('#gbox' + currow + '' + currcol).addClass('shake');
                    $('#gtext' + currow + '' + currcol).text(l);
                    currcol++;
                }
                
                if (guess.length === 6){
                    $('#enter').prop('disabled', false)
                } 
            })

            $('#del').click(function(){
                $('#enter').prop('disabled', true);
                if (guess.length > 0){
                    guess.pop();
                    currcol--;
                    $('#gtext' + currow + '' + currcol).text("");
                    $('#gbox' + currow + '' + currcol).removeClass('shake');  
                }

                if (guess.length === 0){
                    $(this).prop('disabled', true);
                }

                if (guess.length < 6){
                    $('.kbkey').prop('disabled', false);
                }
            })

            $('#enter').click(function(){
                $(this).prop('disabled', true);
                $('#color').css('background-color', "#" + guess.join(''));
                $('#color').css('color', "#" + targetcolor);
                // show results
                    // find exact matches
                    const targetArr = targetcolor.split('');
                    for (let i = 0; i < 6; i++){
                        if (guess[i] == targetArr[i]){
                            result[i] = 'green';
                            // $('#gbox' + currow + '' + i).css('background', 'green') 
                            green.push(targetArr[i])
                            // $('#b' + targetArr[i]).css('background', 'green');
                            targetArr[i] = "g"; //block green guess from being recounted
                            guess[i] = "y";
                        }
                    }
                    //find matches within target but in in correct location
                    // for letter in target
                    for (let i = 0; i < 6; i++){
                        if (targetArr[i] != "x"){
                            let tl = targetArr[i];
                            // for letter in guess
                            for (let j = 0; j < 6; j++){
                                if (guess[j] == tl){
                                    result[j] = 'yellow';
                                    // $('#gbox' + currow + '' + j).css('background', 'yellow'); 
                                    yellow.push(targetArr[i]);
                                    targetArr[i] = "x"; // prevent recounts
                                    guess[j] = "y";
                                    break;
                                }
                                else if (guess[j] != 'y'){
                                    result[j] = 'gray';
                                    gray.push(guess[j]);
                                }
                            }  
                        }
                    }  

                    //show result of guess
                    var tilesArray = [$('#gbox' + currow + '' + 0), $('#gbox' + currow + '' + 1), $('#gbox' + currow + '' + 2), $('#gbox' + currow + '' + 3), $('#gbox' + currow + '' + 4), $('#gbox' + currow + '' + 5)]
                    tilesArray.map(function (tile, i) {
                        tile.addClass('flip');
                        tile.css('animation-delay', `${i * 300}ms`);
                        setTimeout(() => {
                            tile.addClass(result[i]);
                        }, i * 300)
                    });

                    //after results are displayed
                    setTimeout(() => {
                        //change the color of keyboard
                        //change to better method, this one overwrites itself 
                        gray.forEach((word, i) => {
                            $('#b' + gray[i]).addClass('gray')
                        })
                        yellow.forEach((word, i) => {
                            $('#b' + yellow[i]).addClass('yellow')
                        })
                        green.forEach((word, i) => {
                            $('#b' + green[i]).addClass('green')
                        })

                        //if won
                        if (targetArr.join('')=='gggggg'){ // if answer is completely right
                            $('#color').css('color', 'white');
                            confetti();
                            if (currow == 0){
                                $('#alert').html(`You solved the Hexdle on your first try!`);
                            } else{
                                $('#alert').html(`You solved the Hexdle in ${currow + 1} tries!`);
                            }
                            game = false;

                        //if lost
                        } else if ((currow + 1) === allowedtries){
                            $('#alert').append(`The color was #${color}. Better luck next time!`)
                            game = false;
                        
                        } else{
                            currow ++;
                        } 
                        currcol = 0;
                        guess = [];

                        if (game == false){
                            $('.kbkey').prop('disabled', true);
                            $('#enter').prop('disabled', true);
                            $('#del').prop('disabled', true);
                            green = [];
                            yellow = [];
                            gray = [];
                            currow = 0;
                            currcol = 0;
                        }
                    }, 2400);

            })
        })
  
    </script>
</body>

</html>